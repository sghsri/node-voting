<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css">
    <title>Document</title>
</head>

<body>
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-12">
                    <div class="content is-large">
                        <div class="box">
                            <form id="form" action="javascript:createParty()">
                                <label class="title" for="question" style="font-weight: bold">Question: </label>
                                <input style='margin-left:5px' type="text" id="question" name="question" value="">
                                <br>
                                <br>
                                <input type="submit" id="create" class='button is-success' value="Create">
                            </form>
                            <button id='addMore' class='button is-warning' style="margin-top:10px;">Add Answer</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

    <script>
        $("#addMore").click(e => {
            $("#create").before(
                "<label class='subtitle'>Answer: </><input style = 'margin-left:5px' type='text' name='answer'></><br><br>"
            );
        });

        function createParty() {
            var party = {
                question: $("#question").val(),
                answers: []
            }
            if ($('input[name="answer"]').length) {
                $('input[name="answer"]').each(function () {
                    party.answers.push({
                        answertext: $(this).val(),
                        votes: 0
                    })
                });

                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        console.log(this.responseText);
                        window.location.href = `/host/${this.responseText}`;
                    }
                };
                xhttp.open("POST", `/create`, true);
                xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
                xhttp.send(JSON.stringify(party));
            } else {
                alert("Must have at least one answer choice;")
            }

        }
    </script>
</body>

</html>